<!DOCTYPE html><html lang="en"> <head><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v4.1.3"><title>Gentoo 安装笔记</title><meta charset="utf-8"><link rel="canonical" href="https://revysr.github.io/posts/20200304-gentoo/"><meta name="robots" content="index, follow"><meta property="og:title" content="Gentoo 安装笔记"><meta property="og:type" content="article"><meta property="og:image" content="https://github.com/moeyua/astro-theme-typography/blob/85204bceb6dbc1314dd5d5e4ae5773af01ddea79/public/typograph-og.jpg"><meta property="og:url" content="https://revysr.github.io/"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><meta content="https://github.com/moeyua/astro-theme-typography/blob/85204bceb6dbc1314dd5d5e4ae5773af01ddea79/public/typograph-og.jpg" name="twitter:image"><meta content="Gentoo 安装笔记" name="twitter:title"><meta content="" name="twitter:description"><link rel="stylesheet" href="/_astro/about.NTXzv6ay.css" />
<style>.copy-code{position:absolute;top:0;right:0;background-color:#3730a3;padding:.25rem .5rem;font-size:.75rem;line-height:1rem;border-radius:0 0 0 .25rem}.copy-code:hover{background-color:#312e81}
</style><script type="module">const n="Copy",r=Array.from(document.querySelectorAll("pre"));for(let e of r){let t=document.createElement("div");t.style.position="relative";let o=document.createElement("button");o.className="copy-code",o.innerHTML=n,e.setAttribute("tabindex","0"),e.appendChild(o),e.parentNode?.insertBefore(t,e),t.appendChild(e),o.addEventListener("click",async()=>{await i(e,o)})}async function i(e,t){let c=e.querySelector("code")?.innerText;await navigator.clipboard.writeText(c??""),t.innerText="Code Copied",setTimeout(()=>{t.innerText=n},700)}
</script></head> <body> <div un-max-lg="animate-fadein-down" un-lg="flex flex-row-reverse justify-center gap-4 px-8" class="container contain-layout m-a"> <div un-lg="sticky top-0 h-screen py-20 animate-fadein-left gap-8" un-lg:flex="~ col justify-between items-start gap-4" class="p-7.5"> <header un-lg="grow-1 justify-between items-start" un-flex="~ col gap-2.5" class="text-center"> <hgroup un-hover:lg="bg-foreground color-background pt-3.75 pb-8.75 " un-lg=" write-vertical-right items-start px-2.5 pb-12 b-l-2px b-l-foreground-solid text-left" un-flex="~ col gap-2.5" class="cursor-pointer transition-[padding,background] duration-800 ease-in-out"> <a class="normal" href="/"> <h3 class="text-5 font-extrabold font-serif">Typography</h3> <h1 class="text-8 font-extrabold font-serif">活版印字</h1> </a> </hgroup> <nav class="text-center font-bold" un-flex="~ col gap-2"> <ul un-lg="flex-col items-start text-4" class="text-3.5" un-flex="~ row gap-2 justify-center"> <li> <a href="/posts/page/1">Posts</a> </li><li> <a href="/archive">Archive</a> </li><li> <a href="/categories">Categories</a> </li><li> <a href="/about">About</a> </li> </ul> <ul un-flex="~ row gap-1 justify-center"> <li> <a href="https://github.com/moeyua/astro-theme-typography" target="_blank" title="github" class="icon i-mdi-github"></a> </li><li> <a href="/atom.xml" target="_blank" title="rss" class="icon i-mdi-rss"></a> </li><li> <a href="https://github.com/moeyua/astro-theme-typography" target="_blank" title="twitter" class="icon i-mdi-twitter"></a> </li><li> <a href="https://github.com/moeyua/astro-theme-typography" target="_blank" title="mastodon" class="icon i-mdi-mastodon"></a> </li> </ul> </nav> </header> <footer font-bold text-3 un-flex="~ col gap-1" un-lg="gap-3.5" class="max-lg:hidden"> <p>
© 2025 <a target="_blank" href="https://revysr.github.io/" rel="noopener noreferrer">Typography</a> </p> <p>
Theme
<a target="_blank" href="https://github.com/Moeyua/astro-theme-typography" rel="noopener noreferrer">Typography</a>
by <a target="_blank" href="https://moeyua.com" rel="noopener noreferrer">Moeyua</a> </p> <p>
Proudly published with
<a target="_blank" href="https://astro.build" rel="noopener noreferrer">Astro</a> </p> </footer> </div> <main un-lg="py-20 min-w-xl animate-fadein-down" class="p-7.5">  <article class="heti"> <header> <h1 class="post-title!"> <a href="/posts/20200304-gentoo/">Gentoo 安装笔记</a> </h1> <div class="mt-2 text-3.5"> <span>Posted at</span> <time>2020-03-04</time> <a class="ml-2.5" href="/categories/Gentoo"># Gentoo</a><a class="ml-2.5" href="/categories/OS"># OS</a><a class="ml-2.5" href="/categories/Linux"># Linux</a><a class="ml-2.5" href="/categories/Hyper-V"># Hyper-V</a> </div> </header>  <h2 id="开宗明义">开宗明义</h2>
<p><font size="6">Linux 就应该不要选择使用桌面</font></p>
<h3 id="不选择桌面的原因">不选择桌面的原因</h3>
<p>可以节省你大量折腾的时间 包括但不限于以下内容
GNOME 3/KDE 5/Xfce/Mate 等桌面的选择、配置、美化 (我有强迫症)
Windows 上的工具/软件的替代品 (QQ/Wechat etc.)</p>
<h2 id="安装环境与分区方案">安装环境与分区方案</h2>
<p>Windows 10 1909 的 Hyper-V
Ubuntu 18.04.3</p>
<p>以下操作都假设在 <code>root</code> 用户下操作</p>
<h3 id="hyper-v-资源分配方案">Hyper-V 资源分配方案</h3>

























<table><thead><tr><th align="center">资源</th><th align="center">—</th></tr></thead><tbody><tr><td align="center">cpu</td><td align="center">2 core</td></tr><tr><td align="center">ram</td><td align="center">4 GB</td></tr><tr><td align="center">网卡</td><td align="center">Hyper-V 虚拟网卡(桥接)</td></tr><tr><td align="center">硬盘</td><td align="center">光威悍将 480GB(直通)</td></tr></tbody></table>
<p>选择桥接是因为我想把设备都放在一个子网下面
这个方案适合不移动的台式机 笔记本应该选择 NAT 方案</p>
<p>硬盘直通的原因是不想占用硬盘上的空间 正好有闲置硬盘
就直通进去了 坏处是不能享受虚拟机快照功能</p>
<h3 id="分区方案">分区方案</h3>








































<table><thead><tr><th align="left">分区</th><th align="left">磁盘格式</th><th align="left">分区大小</th><th align="left">btrfs 子卷</th><th align="left">挂载点</th></tr></thead><tbody><tr><td align="left">/dev/sda1</td><td align="left">fat32</td><td align="left">2GB</td><td align="left">—</td><td align="left">/boot</td></tr><tr><td align="left">/dev/sda2</td><td align="left">swap</td><td align="left">8GB</td><td align="left">—</td><td align="left">—</td></tr><tr><td align="left">/dev/sda3</td><td align="left">btrfs</td><td align="left">438GB</td><td align="left">rootfs</td><td align="left">/</td></tr><tr><td align="left">—</td><td align="left">—</td><td align="left">—</td><td align="left">homefs</td><td align="left">/home</td></tr></tbody></table>
<p><code>boot</code> 分区分配 2GB 的原因是我喜欢把内核放在 boot 分区
不希望因为多安装几个内核就需要手动移除旧版内核</p>
<p><code>swap</code> 分区创建的原因是 <code>linux 5.0</code> 之前 <code>btrfs</code> 分区不支持使用 <code>swapfile</code>
现在稳定内核是 <code>4.19.97</code> 所以还是创建 swap 分区 防止编译爆内存</p>
<p>剩余空间使用 <code>btrfs</code> 文件系统的原因是我想剩余分区共享大小还能单独备份
最初在 <code>ThinkPad t450s</code> 上实现 <code>FreeBSD</code> 与 <code>Gentoo</code> 公用 <code>zfs</code> 分区的习惯保留下来</p>
<h2 id="安装-gentoo">安装 Gentoo</h2>
<h3 id="分区与挂载">分区与挂载</h3>
<h4 id="创建分区">创建分区</h4>
<p>分区创建 使用 <code>fdisk</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#B392F0">fdisk</span><span style="color:#9ECBFF"> /dev/sda</span></span></code></pre>
<h4 id="格式化分区">格式化分区</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D"># 格式化 boot 分区</span></span>
<span class="line"><span style="color:#B392F0">mkfs.vfat</span><span style="color:#79B8FF"> -F32</span><span style="color:#9ECBFF"> /dev/sda1</span></span>
<span class="line"><span style="color:#6A737D"># 格式化 btrfs 分区</span></span>
<span class="line"><span style="color:#B392F0">mkfs.btrfs</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> /dev/sda3</span></span>
<span class="line"><span style="color:#6A737D"># 格式化 swap 分区</span></span>
<span class="line"><span style="color:#B392F0">mkswap</span><span style="color:#9ECBFF"> /dev/sda2</span></span></code></pre>
<h4 id="挂载分区">挂载分区</h4>
<p>依据 Gentoo 安装文档 我们创建 <code>/mnt/gentoo</code> 分区并挂载相关分区</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D"># 创建 /mnt/gentoo</span></span>
<span class="line"><span style="color:#B392F0">mkdir</span><span style="color:#79B8FF"> -p</span><span style="color:#9ECBFF"> /mnt/gentoo</span></span>
<span class="line"><span style="color:#6A737D"># 挂载 btrfs 分区</span></span>
<span class="line"><span style="color:#B392F0">mount</span><span style="color:#9ECBFF"> /dev/sda3</span><span style="color:#9ECBFF"> /mnt/gentoo</span></span>
<span class="line"><span style="color:#6A737D"># 创建 btrfs 子卷</span></span>
<span class="line"><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> /mnt/gentoo</span></span>
<span class="line"><span style="color:#B392F0">btrfs</span><span style="color:#9ECBFF"> subvol</span><span style="color:#9ECBFF"> create</span><span style="color:#9ECBFF"> rootfs</span></span>
<span class="line"><span style="color:#B392F0">btrfs</span><span style="color:#9ECBFF"> subvol</span><span style="color:#9ECBFF"> create</span><span style="color:#9ECBFF"> hometfs</span></span>
<span class="line"><span style="color:#6A737D"># 解除 btrfs 分区挂载并挂载相应子卷</span></span>
<span class="line"><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> ..</span></span>
<span class="line"><span style="color:#B392F0">umount</span><span style="color:#9ECBFF"> /dev/sda3</span></span>
<span class="line"><span style="color:#B392F0">mount</span><span style="color:#9ECBFF"> /dev/sda3</span><span style="color:#9ECBFF"> /mnt/gentoo</span><span style="color:#79B8FF"> -o</span><span style="color:#9ECBFF"> subvol=rootfs,compress=zstd,noatime,discard,ssd,space_cache</span></span>
<span class="line"><span style="color:#B392F0">mkdir</span><span style="color:#9ECBFF"> /mnt/gentoo/home</span></span>
<span class="line"><span style="color:#B392F0">mount</span><span style="color:#9ECBFF"> /dev/sda3</span><span style="color:#9ECBFF"> /mnt/gentoo/home</span><span style="color:#79B8FF"> -o</span><span style="color:#9ECBFF"> subvol=homefs,compress=zstd,noatime,discard,ssd,space_cache</span></span>
<span class="line"><span style="color:#6A737D"># 挂载 boot 分区</span></span>
<span class="line"><span style="color:#B392F0">mkdir</span><span style="color:#9ECBFF"> /mnt/gentoo/boot</span></span>
<span class="line"><span style="color:#B392F0">mount</span><span style="color:#9ECBFF"> /dev/sda1</span><span style="color:#9ECBFF"> /mnt/gentoo/boot</span></span>
<span class="line"><span style="color:#6A737D"># 挂载 swap 分区</span></span>
<span class="line"><span style="color:#B392F0">swapon</span><span style="color:#9ECBFF"> /dev/sda2</span></span></code></pre>
<p>-o 后面跟着 硬盘优化选项，如下表所示</p>

















<table><thead><tr><th align="left">硬盘类型</th><th align="left">优化选项</th></tr></thead><tbody><tr><td align="left">SSD</td><td align="left">compress=zstd,noatime,discard,ssd,space_cache</td></tr><tr><td align="left">HDD</td><td align="left">compress-force=zstd,noatime,autodefrag,space_cache</td></tr></tbody></table>
<p>其中压缩选项我们选择了 <code>facebook</code> 的 <a href="https://facebook.github.io/zstd/">zstd</a>
选用新潮压缩技术 做最炫酷的崽</p>  </article> <footer class="mt-5">  <p class="flex items-center gap-2"> <span class="inline-flex items-center"> <i class="i-mdi-chevron-double-left icon"></i> <a href="/posts/20200316-wsl-linux/">Previous post: WSL2的Linux安装与使用</a> </span> <span class="inline-flex items-center"> <a href="/posts/20200303-nas/">Next post: NAS 折腾笔记</a> <i class="i-mdi-chevron-double-right icon"></i> </span> </p> </footer> <!-- <footer class="mt-5">
  <p class="mb-2.5">{t('page_number', page.currentPage)} / {t('page_count', page.lastPage)}</p>
  <p class="flex items-center gap-2">
    <span class="inline-flex items-center">
      <i class="i-mdi-chevron-double-left icon"></i>
      {page.url.prev ? <a href={page.url.prev}> {t('prev')} </a> : <span>{t('prev')}</span>}
    </span>

    <span class="inline-flex items-center">
      {page.url.next ? <a href={page.url.next}>{t('next')}</a> : <span>{t('next')}</span>}
      <i class="i-mdi-chevron-double-right icon"></i>
    </span>
  </p>
</footer> -->  </main> <footer font-bold text-3 un-flex="~ col gap-1" un-lg="gap-3.5" class="lg:hidden p-7.5"> <p>
© 2025 <a target="_blank" href="https://revysr.github.io/" rel="noopener noreferrer">Typography</a> </p> <p>
Theme
<a target="_blank" href="https://github.com/Moeyua/astro-theme-typography" rel="noopener noreferrer">Typography</a>
by <a target="_blank" href="https://moeyua.com" rel="noopener noreferrer">Moeyua</a> </p> <p>
Proudly published with
<a target="_blank" href="https://astro.build" rel="noopener noreferrer">Astro</a> </p> </footer> </div> </body></html>  